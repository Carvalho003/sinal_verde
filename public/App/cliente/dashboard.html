<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="icon" href="../img/logos/logo maior.png">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://kit.fontawesome.com/d5ea0dfb99.js" crossorigin="anonymous"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../../css/fonts.css">
    <link rel="stylesheet" href="../../css/root.css">
    <link rel="stylesheet" href="../../css/style_dashboard.css">
    <link rel="stylesheet" href="../../css/header.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="aparecer1h()">
    <main class="screen-dash">
        <nav class="side-bar">
            <div class="nav-logo">
                <img src="../../img/logos/logo sinal verde- nome e cores ajustadas.png" alt="">
            </div>
            <ul class="list-nav">
                <div class="item-nav item-active">
                    <a href="./dashboard.html" class="icon-text-nav">
                        <i class='bx bxs-dashboard'></i>
                        <span>dashboard</span>
                    </a>
                </div>
                <li class="item-nav">
                    <a href="./colaboradores.html" class="icon-text-nav">
                        <i class='bx bx-user-voice'></i>
                        <span>colaboradores</span>
                    </a>
                </li>

            </ul>
            <a class="item-nav" href="../login.html" style="text-decoration: none;">
                <div class="item-nav logout-sec">
                    <div class="icon-text-nav">
                        <i class='bx bx-log-out'></i>
                        <span>sair</span>
                    </div>
                </div>
            </a>
        </nav>
        <main class="main-content">
            <header class="header-colab">
                <div class="header-content-aside"></div>
                <div class="title-section">
                    <div>
                        <div class="dashboard-search">
                            <h1>Dashboard</h1>
                            <div id="search_geral">
                                <button class="search" onclick="searchModal()"></button>
                            </div>
                        </div>
                        <div class="bairro-search">
                            <select id="slt_bairro" class="select-cabecalho" onchange="buscarLogradouros()">
                                <option value="a">São Miguel Paulista - SP São Paulo ZL</option>
                            </select>
                        </div>
                        <div class="rua-search">
                            <span style="font-size: 20px">Logradouro:</span>
                            <select onchange="trocarGrafico()" id="slt_ruas" class="select-cabecalho">
                                <option value="b">Avenida Marechal Tito</option>
                                <option value="b">Avenida Rosária</option>
                            </select>
                        </div>
                    </div>
                    <div class="cabecalho-direita">
                        <div class="date-section">
                            <span id="span-date">14/10 SEG 22:03</span>
                        </div>
                        <div class="alerta" style="display: flex;">
                            <span style="color: #A41D1D" id="div_alerta">Avenida Marechal Tito com <br>trânsito parado a 15 minutos</span>
                            <img src="../../img/icons/bell-ring-solid-24.png" alt="" class="alerta-img">
                        </div>
                    </div>
                </div>
            </header>
            <div class="dashboard" >
                <dialog id="modal" style="display: none; height: 662px;"></dialog>
                <div class="container-dashboard">
                    <div class="painel-dashboard">
                        <div class="parte-superior">
                            <div class="kpi-bairros">
                                <div class="sup-bairros">
                                    <span class="titulo-kpi">
                                        Bairros Monitorados
                                    </span>
                                    <div class="valor">
                                        <span class="legenda-kpi">
                                            quantidade total:
                                        </span>
                                        <span class="valor-kpi" id="qtd_bairros"></span>
                                    </div>
                                </div>
                                <img class="imagem-bairros" src="../../img/icons/bxs-business.svg"></img>
                            </div>
                            <div class="kpi-ruas">
                                <div class="sup-ruas">
                                    <span class="titulo-kpi">
                                        Ruas Monitoradas em <span id="bairro_kpi"></span>
                                    </span>
                                    <div class="valor">
                                        <span class="legenda-kpi">
                                            quantidade total:
                                        </span>
                                        <span class="valor-kpi" id="qtd_ruas"></span>
                                    </div>
                                </div>
                                <img class="imagem-ruas" src="../../img/icons/bx-street-view.svg"/>
                            </div>
                            <div class="percentual">
                                <span class="titulo-percentual">Porcentagem de ruas congestionadas em <span id="spn_porcentagem"></span>:</span>
                                <div class="corpo-percentual">
                                    <div style="height: 250px;">
                                        <canvas class="grafico-setor" id="setor"></canvas>
                                    </div>
                                    <div class="legendas-setor">
                                        <div class="legenda">
                                            <div class="legenda-verde"></div>
                                            <span class="legenda-percentual">Ruas Livres</span>
                                        </div>
                                        <div class="legenda">
                                            <div class="legenda-vermelha"></div>
                                            <span class="legenda-percentual">Ruas Congestionadas</span>
                                        </div>
                                    </div>
                                    <img class="imagem-setor" src="../../img/icons/bx-doughnut-chart.svg">
                                </div>
                            </div>
                        </div>
                        <div class="parte-inferior">
                            <div class="superior-grafico-linha">
                                <span class="titulo-grafico">
                                    Monitoramento Do Fluxo de Movimento da Rua: <span id="spn_grafico"></span>
                                </span>
                                    <div class="cards-horario">
                                        <button onclick="aparecer1h()" class="card-horario" style="background-color: #1D6975; color: #FFFFFF" id="umaH">1h</button>
                                        <button onclick="aparecer6h()" class="card-horario" style="background-color: #FFF; color: #000000" id="seisH">6h</button>
                                        <button onclick="aparecer12h()" class="card-horario" style="background-color: #FFF; color: #000000" id="dozeH">12h</button>
                                        <button onclick="infoModal()" class="info"></button>
                                    </div>
                            </div>
                                <canvas id="grafico_linha1" display="none" class="grafico-linha"></canvas>
                                <canvas id="grafico_linha6" display="none" class="grafico-linha"></canvas>
                                <canvas id="grafico_linha12" display="none" class="grafico-linha"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </main>
</body>

</html>

<script>
    const graficoSetor = document.getElementById('setor'); // const == variável constante

    // se tiver [] é vetor, se tiver {} é json = juntar inúmeras propriedades dentro de um grupo

     new Chart(graficoSetor, {
        type: 'doughnut', // tipo do gráfico 
        data: { // data = todos os valores que serão colocados
            datasets: [{ // métricas do gráfico = linha
                backgroundColor: ['#A41D1D', '#1DA426'],
                borderColor: ['#A41D1D', '#1DA426'],
                data: [66, 34], // valores do gráfico
                borderWidth: 1 // largura da borda do gráfico
            }]
        },
        options: { // opções do formato do gráfico
            plugins:{
                customCanvasBackgroundColor: {
                    color: '#FFFFFF',
                },
                tooltip: {
                    enable: false
                }
            },
            cutout: '70%',
            responsive: true
        }/*,
            plugins: {
                id: 'grafico-setor',
                beforeDraw: (chart) => {
                    const largura = chart.width;
                    const altura = chart.height;
                    const ctx = chart.ctx;
                    ctx.restore();
                    const fontSize = 40;
                    ctx.font = `${fontSize}em sans-serif`;
                    ctx.textBaseline = "middle";

                    const mensagem = "68%";
                    const coordenadaX = Math.round((largura - ctx.measureText(mensagem).largura) / 2);
                    const coordenadaY = altura / 2;

                    ctx.fillStyle = "#8b0000";
                    ctx.fillText(mensagem, coordenadaX, coordenadaY);
                    ctx.save();
                }
            }*/
    });
</script>

<script>

    var grafico_atual;
    var horariosAtual = ['09:45', '09:40', '09:45', '09:50', '09:55', '10:00', '10:05', '10:10', '10:15', '10:20', '10:25', '10:30',];

    var valoresAtual = [200, 300, 350, 400, 380, 360, 280, 240, 220, 230, 290, 300];

    var valoresMAtual = [240, 310, 340, 370, 400, 370, 290, 240, 250, 255, 270, 280];

    function aparecer1h() {
        carregarkpi1();
        var graficoBarras = document.getElementById('grafico_linha1');
        grafico_linha1.style.display = 'flex';
        grafico_linha6.style.display = 'none';
        grafico_linha12.style.display = 'none';

        umaH.style.backgroundColor = '#1D6975';
        umaH.style.color = '#FFFFFF'
        seisH.style.backgroundColor = '#FFF';
        seisH.style.color = '#000000'
        dozeH.style.backgroundColor = '#FFF';
        dozeH.style.color = '#000000';

        // Horários:
        var horariosAtual = ['09:45', '09:40', '09:45', '09:50', '09:55', '10:00', '10:05', '10:10', '10:15', '10:20', '10:25', '10:30',];
    
        // Valores:
        var valoresAtual = [200, 300, 350, 400, 380, 360, 280, 240, 220, 230, 290, 300];
            
        // Valores Médio:
        var valoresMAtual = [240, 310, 340, 370, 400, 370, 290, 240, 250, 255, 270, 280];
        
        grafico_atual = new Chart(graficoBarras, {
            type: 'line', // tipo do gráfico 
            data: { // data = todos os valores que serão colocados
                labels: horariosAtual, // array = vetores que serão utilizados na label
                datasets: [{ // métricas do gráfico = linha
                    label: 'Avenida 1', // nome da linha
                    backgroundColor: '#1DA426',
                    borderColor: '#1DA426',
                    data: valoresAtual, // valores do gráfico
                    borderWidth: 1 // largura da borda do gráfico
                }, {
                    label: 'Média do bairro',
                    backgroundColor: '#A41D1D',
                    borderColor: '#A41D1D',
                    data: valoresMAtual,
                    borderWidth: 1
                }]
            },
            options: { // opções do formato do gráfico
                scales: {
                    y: {
                        display: false,
                        grid: {
                            display: false
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                    tension: 0.55,
                plugins:{
                    title:{
                        display:false
                    },
                    legend:{
                        position:'top',
                        labels:{
                            boxHeight:3
                        }
                    }
                }
            }
        });
    }

    function aparecer6h() {
        var graficoBarras = document.getElementById('grafico_linha6');
        grafico_linha1.style.display = 'none';
        grafico_linha6.style.display = 'flex';
        grafico_linha12.style.display = 'none';
        console.log('6h');

        umaH.style.backgroundColor = '#FFF';
        umaH.style.color = '#000000'
        seisH.style.backgroundColor = '#1D6975';
        seisH.style.color = '#FFFFFF'
        dozeH.style.backgroundColor = '#FFF';
        dozeH.style.color = '#000000';

        // Horários
        var horariosAtual = ['05:30', '06:00', '06:30', '07:00', '07:30', '08:00', '08:30', '09:00', '09:30', '09:30', '10:00', '10:30'];
    
        // Valores
        var valoresAtual = [280, 290, 290, 270, 273, 295, 300, 305, 301, 287, 280, 273];
            
        // Valores Médio:
        var valoresMAtual = [270, 310, 330, 320, 315, 305, 290, 285, 290, 270, 275, 275];

        new Chart(graficoBarras, {
            type: 'line', // tipo do gráfico 
            data: { // data = todos os valores que serão colocados
                labels: horariosAtual, // array = vetores que serão utilizados na label
                datasets: [{ // métricas do gráfico = linha
                    label: 'Avenida 1', // nome da linha
                    backgroundColor: '#1DA426',
                    borderColor: '#1DA426',
                    data: valoresAtual, // valores do gráfico
                    borderWidth: 1 // largura da borda do gráfico
                }, {
                    label: 'Média do bairro',
                    backgroundColor: '#A41D1D',
                    borderColor: '#A41D1D',
                    data: valoresMAtual,
                    borderWidth: 1
                }]
            },
            options: { // opções do formato do gráfico
                scales: {
                    y: {
                        display: false,
                        grid: {
                            display: false
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                    tension: 0.55,
                plugins:{
                    title:{
                        display:false
                    },
                    legend:{
                        position:'top',
                        labels:{
                            boxHeight:3
                        }
                    }
                }
            }
        });
    }

    function aparecer12h() {
        console.log('12h');
        var graficoBarras = document.getElementById('grafico_linha12');
        grafico_linha1.style.display = 'none';
        grafico_linha6.style.display = 'none';
        grafico_linha12.style.display = 'flex';

        umaH.style.backgroundColor = '#FFF';
        umaH.style.color = '#000000'
        seisH.style.backgroundColor = '#FFF';
        seisH.style.color = '#000000'
        dozeH.style.backgroundColor = '#1D6975';
        dozeH.style.color = '#FFFFFF'

        // Horários
        var horariosAtual = ['23:30','00:30','01:30','02:30','03:30','04:30','05:30','06:30','07:30', '08:30', '09:30', '10:30',];
    
        // Valores
        var valoresAtual = [287, 290, 285, 280, 279, 275, 275, 280, 285, 281, 290, 291]
        
        // Valores Médio:
        var valoresMAtual = [280, 285, 283, 275, 271, 270, 276, 279, 280, 274, 281, 282]

        new Chart(graficoBarras, {
            type: 'line', // tipo do gráfico 
            data: { // data = todos os valores que serão colocados
                labels: horariosAtual, // array = vetores que serão utilizados na label
                datasets: [{ // métricas do gráfico = linha
                    label: 'Avenida 1', // nome da linha
                    backgroundColor: '#1DA426',
                    borderColor: '#1DA426',
                    data: valoresAtual, // valores do gráfico
                    borderWidth: 1 // largura da borda do gráfico
                }, {
                    label: 'Média do bairro',
                    backgroundColor: '#A41D1D',
                    borderColor: '#A41D1D',
                    data: valoresMAtual,
                    borderWidth: 1
                }]
            },
            options: { // opções do formato do gráfico
                scales: {
                    y: {
                        display: false,
                        grid: {
                            display: false
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                    tension: 0.55,
                plugins:{
                    title:{
                        display:false
                    },
                    legend:{
                        position:'top',
                        labels:{
                            boxHeight:3
                        }
                    }
                }
            }
        });
    }

</script>
<script src="../js/togglemenu.js"></script>

<script src="../js/main.js"></script>

<script>
    setInterval(() => {

    })

    function trocarGrafico(){
        vetor_rua.push('Teste');
        var rua = slt_ruas.value;
        var a = vetor_rua[rua];

        if(a == undefined) {
            a = 'Teste'
        }
        
        spn_grafico.innerHTML = a;

        grafico_atual.data.datasets.label = `'${a[rua]}'`;

        let  lista_valores =[1,1,1,1,1,1,1,1,1,1,1,1]
        let lista_valores2 = []
        for(let i = 0; i < 12;i++){
            // lista_valores.push(Math.floor(Math.random() * 6 + 1))
            lista_valores2.push(Math.floor(Math.random() * 6 + 1))
        }
        console.log(lista_valores)
        console.log(grafico_atual)

        grafico_atual.data.datasets[0].data = lista_valores;
        grafico_atual.data.datasets[1].data = lista_valores2;
        grafico_atual.update()
        
}

var idEmpresaVar = sessionStorage.EMPRESA_ID;

function carregarkpi1() {
    console.log('to no carregarkpi1')
    var qtd = 0;

    console.log(idEmpresaVar);

    fetch("/logradouro/kpi1", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            idEmpresaServer: idEmpresaVar
        })
    }).then(function (resposta) {
        console.log(resposta)

            resposta.json().then(json => {
                console.log(json.logradouro);
                qtd = json.logradouro;
                qtd_bairros.innerHTML = `${qtd}`;
                carregarkpi2();
            });

    }).catch(function (erro) {
        console.log(erro);
    })

    return false;
}

function carregarkpi2() {
    console.log('to no carregarkpi2')
    var qtd = 0;

    fetch("/logradouro/kpi2", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            idEmpresaServer: idEmpresaVar
        })
    }).then(function (resposta) {
        console.log(resposta)

            resposta.json().then(json => {
                console.log(json.logradouro);
                qtd = json.logradouro;
                qtd_ruas.innerHTML = `${qtd}`;
                mostrarBairros();
            });

    }).catch(function (erro) {
        console.log(erro);
    })

    return false;
}
var vetor_bairro = [];
var vetor_cidade = [];

function mostrarBairros() {
    var vetor = '';
    var mensagem = '';

    fetch("/logradouro/select_bairro", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            idEmpresaServer: idEmpresaVar
        })
    }).then(function (resposta) {
        console.log(resposta)

            resposta.json().then(json => {
                console.log(json.lista);
                vetor = json.lista;
                for(var i = 0; i < vetor.length; i++) {
                    if(!vetor_bairro.includes(vetor[i].bairro)) {
                        vetor_bairro.push(vetor[i].bairro);
                        vetor_cidade.push(vetor[i].Cidade);

                        mensagem += `
                            <option value="${i}">${vetor[i].bairro}  - ${vetor[i].Unidade} ${vetor[i].Cidade} ${vetor[i].Regiao} </option>
                        `;
                    }
                }
                console.log(vetor_bairro);

                slt_bairro.innerHTML = mensagem;

                buscarLogradouros()
            });

    }).catch(function (erro) {
        console.log(erro);
    })

    return false;
}
var vetor_rua = [];

function buscarLogradouros() {
    var numero_vetor = slt_bairro.value;
    var nomeBairroVar = vetor_bairro[numero_vetor];
    var nomeCidadeVar = vetor_cidade[numero_vetor];
    var mensagem = '';

    bairro_kpi.innerHTML = nomeBairroVar;
    spn_porcentagem.innerHTML = nomeBairroVar;

    console.log(`${nomeBairroVar} ${nomeCidadeVar}`);

    console.log(vetor_bairro);
    
    fetch("/logradouro/select_ruas", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            nomeBairroServer: nomeBairroVar,
            nomeCidadeServer: nomeCidadeVar
        })
    }).then(function (resposta) {
        console.log(resposta)

            resposta.json().then(json => {
                console.log(json.lista);
                var vetor = json.lista;
                
                for(var i = 0; i < vetor.length; i++) {
                    vetor_rua.push(vetor[i].Logradouro);
                    mensagem += `
                        <option value="${i}">${vetor[i].Logradouro}</option>
                        <option value="${i + 1}">Teste</option>
                    `;
                }

                slt_ruas.innerHTML = mensagem;
                trocarGrafico(vetor_rua);
            });

    }).catch(function (erro) {
        console.log(erro);
    })

    return false;
}

</script>